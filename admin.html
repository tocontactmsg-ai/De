<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eldelala — Admin (Fixed UTF-8)</title>
  <style>
    :root{
      --bg:#f3f7fc;
      --card:#ffffff;
      --muted:#64748b;
      --accent:#06b6d4;
      --accent-dark:#0f766e;
      --danger:#ef4444;
      --success:#10b981;
      --border:#e2e8f0;
    }
    *{box-sizing:border-box}
    body{
      font-family:system-ui,-apple-system,'Segoe UI',Roboto,Arial;
      background:var(--bg);
      margin:0;
      padding:16px;
      color:#071426;
    }
    .container{max-width:1100px;margin:0 auto}
    header{
      background:linear-gradient(120deg,#0ea5e9,#0369a1);
      color:#ecfeff;
      padding:10px 14px;
      border-radius:14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:10px;
    }
    h1{margin:0;font-size:18px}
    .controls{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    input,button{
      padding:8px;
      border-radius:8px;
      border:1px solid rgba(15,23,42,0.1);
      font-size:13px;
    }
    input{
      background:#fff;
    }
    button{
      cursor:pointer;
      background:#f9fbff;
    }
    button:hover{
      background:#eef2ff;
    }
    .btn-primary{
      background:#0ea5e9;
      color:#fff;
      border-color:#0284c7;
    }
    .btn-primary:hover{
      background:#0369a1;
    }
    .btn-danger{
      background:#fee2e2;
      color:#b91c1c;
      border-color:#fecaca;
    }
    .btn-success{
      background:#ecfdf5;
      color:#047857;
      border-color:#bbf7d0;
    }
    .panel{
      background:var(--card);
      border-radius:14px;
      border:1px solid var(--border);
      margin-top:12px;
      padding:12px;
    }
    .row{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .row > *{flex:1 1 auto}
    .row-fixed{flex:none}
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      gap:10px;
      margin-top:10px;
    }
    .card{
      border:1px solid var(--border);
      border-radius:12px;
      padding:8px;
      background:#fff;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .thumb{
      width:100%;
      height:150px;
      border-radius:10px;
      object-fit:cover;
      background:#0f172a;
    }
    .meta{
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .badge{
      display:inline-block;
      padding:2px 6px;
      border-radius:999px;
      font-size:11px;
    }
    .badge-id{background:#0f172a;color:#e5e7eb;}
    .badge-status{background:#e0f2fe;color:#0369a1;}
    .btns{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:4px;
    }
    .btn-small{
      font-size:11px;
      padding:4px 7px;
      border-radius:999px;
    }
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:20px;
      background:#0f172a;
      color:#fff;
      padding:8px 12px;
      border-radius:10px;
      font-size:13px;
      display:none;
      z-index:9999;
    }
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:999;
    }
    .modal-backdrop.active{display:flex;}
    .modal{
      background:#fff;
      border-radius:16px;
      max-width:480px;
      width:95%;
      max-height:90vh;
      overflow:auto;
      padding:12px;
      border:1px solid var(--border);
    }
    .modal h2{margin:0 0 6px;font-size:16px}
    .field{margin-bottom:6px;display:flex;flex-direction:column;gap:3px}
    .field label{font-size:12px;color:#4b5563}
    .field input,.field textarea{
      padding:7px;
      border-radius:8px;
      border:1px solid var(--border);
      font-size:13px;
    }
    .field textarea{min-height:70px;resize:vertical}
    body.mobile-mode{
      background:#ffffff;
    }
    body.mobile-mode .container{
      max-width:420px;
    }
    @media(max-width:600px){
      header{flex-direction:column;align-items:flex-start}
      .controls{width:100%}
      .controls input{flex:1}
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>لوحة تحكم الدلالة — ثابتة</h1>
      <div style="font-size:12px;opacity:.9">
        UTF-8 صحيح + صور WebP + يعمل على الموبايل والكمبيوتر.
      </div>
    </div>
    <div class="controls">
      <input id="repoInput" placeholder="user/repo" style="width:140px" />
      <input id="tokenInput" placeholder="GitHub PAT" style="width:210px" />
      <button id="loginBtn" class="btn-primary">اتصل</button>
      <button id="mobileViewBtn">عرض موبايل</button>
      <button id="refreshBtn">تحديث</button>
    </div>
  </header>

  <div class="panel row" style="margin-top:12px">
    <input id="searchInput" placeholder="بحث عن إعلان أو ID أو عنوان" />
    <select id="statusFilter" class="row-fixed">
      <option value="all">كل الحالات</option>
      <option value="pending">معلق</option>
      <option value="accepted">مقبول</option>
      <option value="rejected">مرفوض</option>
    </select>
    <button id="newAdBtn" class="btn-success row-fixed">إضافة إعلان جديد</button>
  </div>

  <div class="panel">
    <div style="font-size:14px;margin-bottom:6px">الإعلانات</div>
    <div id="adsGrid" class="grid"></div>
    <div id="emptyState" style="display:none;font-size:13px;color:#64748b;margin-top:8px">
      لا توجد إعلانات بعد. اتصل بالريبو أو أضف إعلان جديد.
    </div>
  </div>

  <div style="margin-top:10px;font-size:12px;color:#64748b">
    هذه النسخة تركز على: اتصال GitHub + عرض/تعديل/إضافة إعلانات بدون تشويه عربي. بعد ما تستقر نقدر نرجع نضيف مزايا متقدمة.
  </div>
</div>

<!-- Edit Ad Modal -->
<div id="editModalBackdrop" class="modal-backdrop">
  <div class="modal">
    <h2 id="editModalTitle">تعديل إعلان</h2>
    <div id="editModalBody">
      <div class="field">
        <label for="e_title">العنوان</label>
        <input id="e_title" />
      </div>
      <div class="field">
        <label for="e_desc">الوصف</label>
        <textarea id="e_desc"></textarea>
      </div>
      <div class="field">
        <label for="e_price">السعر</label>
        <input id="e_price" />
      </div>
      <div class="field">
        <label for="e_location">الموقع</label>
        <input id="e_location" />
      </div>
      <div class="field">
        <label for="e_phone">الهاتف / واتساب</label>
        <input id="e_phone" />
      </div>
      <div class="field">
        <label for="e_files">تغيير الصور (اختياري) — يتم التحويل إلى WebP</label>
        <input id="e_files" type="file" multiple />
      </div>
      <div style="display:flex;justify-content:flex-end;gap:6px;margin-top:6px">
        <button id="e_cancelBtn">إلغاء</button>
        <button id="e_saveBtn" class="btn-primary">حفظ</button>
      </div>
    </div>
  </div>
</div>

<!-- New Ad Modal -->
<div id="newModalBackdrop" class="modal-backdrop">
  <div class="modal">
    <h2>إضافة إعلان جديد</h2>
    <div class="field">
      <label for="n_title">العنوان</label>
      <input id="n_title" />
    </div>
    <div class="field">
      <label for="n_desc">الوصف</label>
      <textarea id="n_desc"></textarea>
    </div>
    <div class="field">
      <label for="n_price">السعر</label>
      <input id="n_price" />
    </div>
    <div class="field">
      <label for="n_location">الموقع</label>
      <input id="n_location" />
    </div>
    <div class="field">
      <label for="n_phone">الهاتف / واتساب</label>
      <input id="n_phone" />
    </div>
    <div class="field">
      <label for="n_files">صور الإعلان (اختياري) — WebP</label>
      <input id="n_files" type="file" multiple />
    </div>
    <div style="display:flex;justify-content:flex-end;gap:6px;margin-top:6px">
      <button id="n_cancelBtn">إلغاء</button>
      <button id="n_saveBtn" class="btn-success">حفظ</button>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
  // ====== DOM ======
  const repoInput = document.getElementById('repoInput');
  const tokenInput = document.getElementById('tokenInput');
  const loginBtn = document.getElementById('loginBtn');
  const mobileViewBtn = document.getElementById('mobileViewBtn');
  const refreshBtn = document.getElementById('refreshBtn');
  const adsGrid = document.getElementById('adsGrid');
  const emptyState = document.getElementById('emptyState');
  const searchInput = document.getElementById('searchInput');
  const statusFilter = document.getElementById('statusFilter');
  const newAdBtn = document.getElementById('newAdBtn');
  const toastEl = document.getElementById('toast');

  // Edit modal
  const editModalBackdrop = document.getElementById('editModalBackdrop');
  const editModalTitle = document.getElementById('editModalTitle');
  const e_title = document.getElementById('e_title');
  const e_desc = document.getElementById('e_desc');
  const e_price = document.getElementById('e_price');
  const e_location = document.getElementById('e_location');
  const e_phone = document.getElementById('e_phone');
  const e_files = document.getElementById('e_files');
  const e_cancelBtn = document.getElementById('e_cancelBtn');
  const e_saveBtn = document.getElementById('e_saveBtn');

  // New ad modal
  const newModalBackdrop = document.getElementById('newModalBackdrop');
  const n_title = document.getElementById('n_title');
  const n_desc = document.getElementById('n_desc');
  const n_price = document.getElementById('n_price');
  const n_location = document.getElementById('n_location');
  const n_phone = document.getElementById('n_phone');
  const n_files = document.getElementById('n_files');
  const n_cancelBtn = document.getElementById('n_cancelBtn');
  const n_saveBtn = document.getElementById('n_saveBtn');

  // ====== State ======
  let REPO = '';
  let TOKEN = '';
  let ADS = [];
  let editingAd = null;

  function showToast(msg, time=2500){
    toastEl.textContent = msg;
    toastEl.style.display = 'block';
    clearTimeout(toastEl._t);
    toastEl._t = setTimeout(()=>{toastEl.style.display='none';}, time);
  }

  // ====== Base64 / UTF-8 helpers ======
  function arrayBufferToBase64(ab){
    const bytes = new Uint8Array(ab);
    let binary = '';
    for(let i=0;i<bytes.length;i++){
      binary += String.fromCharCode(bytes[i]);
    }
    return btoa(binary);
  }

  function base64ToUint8Array(b64){
    const binary = atob(b64);
    const len = binary.length;
    const bytes = new Uint8Array(len);
    for(let i=0;i<len;i++){
      bytes[i] = binary.charCodeAt(i);
    }
    return bytes;
  }

  function textToBase64Utf8(str){
    const encoder = new TextEncoder();
    const bytes = encoder.encode(str);
    return arrayBufferToBase64(bytes.buffer);
  }

  function base64ToTextUtf8(b64){
    const bytes = base64ToUint8Array(b64);
    const decoder = new TextDecoder('utf-8');
    return decoder.decode(bytes);
  }

  // ====== GitHub helpers ======
  async function ghFetch(url, options={}){
    const headers = options.headers ? {...options.headers} : {};
    if(TOKEN){
      headers['Authorization'] = 'token ' + TOKEN;
    }
    const res = await fetch(url, {...options, headers});
    if(!res.ok){
      const text = await res.text().catch(()=> '');
      throw new Error(res.status + ' ' + res.statusText + ' - ' + text.slice(0,200));
    }
    return res;
  }

  async function ghList(path){
    const url = `https://api.github.com/repos/${REPO}/contents/${path}`;
    const res = await ghFetch(url);
    return res.json();
  }

  async function ghGetFile(path){
    const url = `https://api.github.com/repos/${REPO}/contents/${encodeURIComponent(path)}`;
    const res = await ghFetch(url);
    return res.json();
  }

  async function ghPutFile(path, content, message, sha){
    let base64;
    if(content instanceof ArrayBuffer || content instanceof Uint8Array){
      const ab = content instanceof Uint8Array ? content.buffer : content;
      base64 = arrayBufferToBase64(ab);
    }else if(typeof content === 'string'){
      // UTF-8 آمن للنصوص (JSON بالعربي)
      base64 = textToBase64Utf8(content);
    }else{
      base64 = textToBase64Utf8(String(content));
    }
    const body = {message, content: base64};
    if(sha) body.sha = sha;
    const url = `https://api.github.com/repos/${REPO}/contents/${encodeURIComponent(path)}`;
    const res = await ghFetch(url, {
      method:'PUT',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(body)
    });
    return res.json();
  }

  async function ghDeleteFile(path, sha, message){
    const url = `https://api.github.com/repos/${REPO}/contents/${encodeURIComponent(path)}`;
    const body = {message, sha};
    const res = await ghFetch(url, {
      method:'DELETE',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(body)
    });
    return res.json();
  }

  // ====== Image helper: convert to WebP ======
  async function convertImageFileToWebP(file, maxSize=1280, quality=0.8){
    const dataUrl = await new Promise((resolve, reject)=>{
      const reader = new FileReader();
      reader.onload = ()=>resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
    const img = await new Promise((resolve, reject)=>{
      const image = new Image();
      image.onload = ()=>resolve(image);
      image.onerror = reject;
      image.src = dataUrl;
    });
    let {width, height} = img;
    const ratio = Math.min(1, maxSize / Math.max(width, height));
    width = Math.round(width * ratio);
    height = Math.round(height * ratio);
    const canvas = document.createElement('canvas');
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0, width, height);
    const blob = await new Promise((resolve, reject)=>{
      canvas.toBlob(
        (b)=> b ? resolve(b) : reject(new Error('WebP conversion failed')),
        'image/webp',
        quality
      );
    });
    const ab = await blob.arrayBuffer();
    return ab;
  }

  // ====== Load + render ads ======
  async function loadAds(){
    if(!REPO || !TOKEN){
      alert('أدخل user/repo و PAT ثم اضغط اتصل');
      return;
    }
    try{
      const list = await ghList('ads');
      const ads = [];
      for(const f of list){
        if(f.type !== 'file' || !f.name.endsWith('.json')) continue;
        const file = await ghGetFile(f.path);
        const b64 = file.content.replace(/\n/g,'');
        const jsonStr = base64ToTextUtf8(b64);  // هنا UTF-8 الصحيح
        const ad = JSON.parse(jsonStr);
        ad._sha = file.sha;
        ad._path = f.path;
        ads.push(ad);
      }
      ADS = ads;
      renderAds();
      showToast('تم تحميل الإعلانات');
    }catch(err){
      console.error(err);
      alert('خطأ في تحميل الإعلانات: ' + err.message);
    }
  }

  function renderAds(){
    adsGrid.innerHTML = '';
    const q = searchInput.value.trim().toLowerCase();
    const st = statusFilter.value;
    const filtered = ADS.filter(ad=>{
      if(st !== 'all' && ad.status !== st) return false;
      if(!q) return true;
      const id = String(ad.id || '').toLowerCase();
      const title = String(ad.title || '').toLowerCase();
      const desc = String(ad.description || '').toLowerCase();
      return id.includes(q) || title.includes(q) || desc.includes(q);
    });
    if(filtered.length === 0){
      emptyState.style.display = 'block';
      return;
    }else{
      emptyState.style.display = 'none';
    }

    for(const ad of filtered){
      const card = document.createElement('div');
      card.className = 'card';

      const img = document.createElement('img');
      img.className = 'thumb';
      if(ad.primary_image){
        img.src = `images/${ad.primary_image.split('/').pop()}`; // لو index يستعمل نفس المسار، عدّل حسب طريقتك
      }else if(ad.images && ad.images.length){
        img.src = `images/${ad.images[0].split('/').pop()}`;
      }
      card.appendChild(img);

      const titleEl = document.createElement('div');
      titleEl.style.fontWeight = '600';
      titleEl.style.fontSize = '14px';
      titleEl.textContent = ad.title || 'بدون عنوان';
      card.appendChild(titleEl);

      const descEl = document.createElement('div');
      descEl.style.fontSize = '12px';
      descEl.style.color = '#64748b';
      descEl.textContent = ad.location || '';
      card.appendChild(descEl);

      const meta = document.createElement('div');
      meta.className = 'meta';
      const idSpan = document.createElement('span');
      idSpan.innerHTML = `ID: <span class="badge badge-id">${ad.id || ''}</span>`;
      const stSpan = document.createElement('span');
      const statusText = ad.status || 'pending';
      let stLabel = 'معلق';
      if(statusText === 'accepted') stLabel = 'مقبول';
      if(statusText === 'rejected') stLabel = 'مرفوض';
      stSpan.innerHTML = `<span class="badge badge-status">${stLabel}</span>`;
      meta.appendChild(idSpan);
      meta.appendChild(stSpan);
      card.appendChild(meta);

      const btns = document.createElement('div');
      btns.className = 'btns';

      const bEdit = document.createElement('button');
      bEdit.textContent = 'تعديل';
      bEdit.className = 'btn-small';
      bEdit.onclick = ()=> openEditModal(ad);
      btns.appendChild(bEdit);

      const bAccept = document.createElement('button');
      bAccept.textContent = 'قبول';
      bAccept.className = 'btn-small btn-success';
      bAccept.onclick = ()=> updateStatus(ad, 'accepted');
      btns.appendChild(bAccept);

      const bReject = document.createElement('button');
      bReject.textContent = 'رفض';
      bReject.className = 'btn-small';
      bReject.onclick = ()=> updateStatus(ad, 'rejected');
      btns.appendChild(bReject);

      const bDelete = document.createElement('button');
      bDelete.textContent = 'حذف';
      bDelete.className = 'btn-small btn-danger';
      bDelete.onclick = ()=> deleteAd(ad);
      btns.appendChild(bDelete);

      card.appendChild(btns);
      adsGrid.appendChild(card);
    }
  }

  async function updateStatus(ad, st){
    try{
      ad.status = st;
      ad.updated_at = new Date().toISOString();
      const path = `ads/${ad.id}.json`;
      const existing = await ghGetFile(path);
      const sha = existing ? existing.sha : undefined;
      await ghPutFile(path, JSON.stringify(ad, null, 2), `set status ${st} ${ad.id}`, sha);
      const idx = ADS.findIndex(a=>a.id===ad.id);
      if(idx>=0) ADS[idx] = ad;
      renderAds();
      showToast('تم تحديث الحالة');
    }catch(err){
      alert('فشل تحديث الحالة: ' + err.message);
    }
  }

  async function deleteAd(ad){
    if(!confirm('تأكيد حذف الإعلان؟')) return;
    try{
      const j = await ghGetFile(`ads/${ad.id}.json`);
      if(j && j.sha){
        await ghDeleteFile(`ads/${ad.id}.json`, j.sha, `delete ad ${ad.id}`);
      }
      ADS = ADS.filter(a=>a.id !== ad.id);
      renderAds();
      showToast('تم حذف الإعلان (الصور لم تُحذف في هذه النسخة البسيطة).');
    }catch(err){
      alert('فشل الحذف: ' + err.message);
    }
  }

  // ====== Edit modal ======
  function openEditModal(ad){
    editingAd = ad;
    editModalTitle.textContent = 'تعديل الإعلان: ' + (ad.id || '');
    e_title.value = ad.title || '';
    e_desc.value = ad.description || '';
    e_price.value = ad.price || '';
    e_location.value = ad.location || '';
    e_phone.value = ad.phone || ad.whatsapp || '';
    e_files.value = '';
    editModalBackdrop.classList.add('active');
  }
  function closeEditModal(){
    editModalBackdrop.classList.remove('active');
    editingAd = null;
  }
  e_cancelBtn.onclick = closeEditModal;

  e_saveBtn.onclick = async ()=>{
    if(!editingAd) return;
    try{
      editingAd.title = e_title.value.trim();
      editingAd.description = e_desc.value.trim();
      editingAd.price = e_price.value.trim();
      editingAd.location = e_location.value.trim();
      editingAd.phone = e_phone.value.trim();
      editingAd.whatsapp = editingAd.phone;
      editingAd.updated_at = new Date().toISOString();

      const files = e_files.files;
      if(files && files.length > 0){
        editingAd.images = [];
        let idx = 1;
        for(const f of files){
          const webpAb = await convertImageFileToWebP(f);
          const path = `images/${editingAd.id}-${idx}.webp`;
          await ghPutFile(path, webpAb, `upload image ${path}`);
          editingAd.images.push(path);
          idx++;
        }
        editingAd.primary_image = editingAd.images[0] || null;
      }

      const path = `ads/${editingAd.id}.json`;
      const existing = await ghGetFile(path);
      const sha = existing ? existing.sha : undefined;
      await ghPutFile(path, JSON.stringify(editingAd, null, 2), `update ad ${editingAd.id}`, sha);

      const idx = ADS.findIndex(a=>a.id===editingAd.id);
      if(idx>=0) ADS[idx] = editingAd;

      renderAds();
      showToast('تم حفظ التعديلات');
      closeEditModal();
    }catch(err){
      alert('فشل حفظ التعديل: ' + err.message);
    }
  };

  // ====== New ad modal ======
  function openNewModal(){
    n_title.value = '';
    n_desc.value = '';
    n_price.value = '';
    n_location.value = '';
    n_phone.value = '';
    n_files.value = '';
    newModalBackdrop.classList.add('active');
  }
  function closeNewModal(){
    newModalBackdrop.classList.remove('active');
  }
  n_cancelBtn.onclick = closeNewModal;

  n_saveBtn.onclick = async ()=>{
    try{
      const title = n_title.value.trim();
      if(!title){
        alert('أدخل العنوان');
        return;
      }
      const desc = n_desc.value.trim();
      const price = n_price.value.trim();
      const loc = n_location.value.trim();
      const phone = n_phone.value.trim();
      const files = n_files.files;

      const id = 'eld-' + Date.now();
      const ad = {
        id,
        title,
        description: desc,
        price,
        currency: 'SDG',
        location: loc,
        phone,
        whatsapp: phone,
        status: 'pending',
        images: [],
        primary_image: null,
        created_at: new Date().toISOString(),
        updated_at: new Date().toISOString()
      };

      if(files && files.length > 0){
        let idx = 1;
        for(const f of files){
          const webpAb = await convertImageFileToWebP(f);
          const path = `images/${id}-${idx}.webp`;
          await ghPutFile(path, webpAb, `upload image ${path}`);
          ad.images.push(path);
          idx++;
        }
        ad.primary_image = ad.images[0] || null;
      }

      await ghPutFile(`ads/${id}.json`, JSON.stringify(ad, null, 2), `create ad ${id}`);

      ADS.unshift(ad);
      renderAds();
      showToast('تم إنشاء الإعلان');
      closeNewModal();
    }catch(err){
      alert('فشل إنشاء الإعلان: ' + err.message);
    }
  };

  // ====== Events ======
  loginBtn.onclick = ()=>{
    const repo = repoInput.value.trim();
    const token = tokenInput.value.trim();
    if(!repo || !token){
      alert('أدخل user/repo و PAT');
      return;
    }
    REPO = repo;
    TOKEN = token;
    try{
      sessionStorage.setItem('eld_repo_fixed', REPO);
      sessionStorage.setItem('eld_token_fixed', TOKEN);
    }catch(e){}
    loadAds();
  };

  refreshBtn.onclick = ()=> loadAds();
  searchInput.oninput = ()=> renderAds();
  statusFilter.onchange = ()=> renderAds();
  newAdBtn.onclick = ()=>{
    if(!REPO || !TOKEN){
      alert('اتصل بالريبو أولاً');
      return;
    }
    openNewModal();
  };

  mobileViewBtn.onclick = ()=>{
    const active = document.body.classList.toggle('mobile-mode');
    mobileViewBtn.textContent = active ? 'وضع عادي' : 'عرض موبايل';
    window.scrollTo(0,0);
  };

  window.addEventListener('DOMContentLoaded', ()=>{
    try{
      const r = sessionStorage.getItem('eld_repo_fixed');
      const t = sessionStorage.getItem('eld_token_fixed');
      if(r){
        REPO = r;
        repoInput.value = r;
      }
      if(t){
        TOKEN = t;
        tokenInput.value = t;
      }
    }catch(e){}
  });
</script>
</body>
</html>
